<head>
	<title>Mario Assignment 7</title>
	<meta charset = "UTF-8">
</head>
<body><br>
<canvas id = "myCanvas" width = "800" height = "500" style = "border:2px solid #ffffff;"></canvas>
<script type = "text/javascript">

class Sprite
{
	constructor(x, y, width, height){
		this.x = x;
		this.y = y;
		this.width = width;
		this.height = height;
		this.image = new Image();
	}
	onclick(x, y)
	{
	}
	update()
	{
	}
	checkCollision(s){   
		if(this.x + 60 <= s.x)
			return false;
		if(this.x >= s.x + 100)
			return false;
		if(this.y + 95 <= s.y) //bottom side
			return false;
		if(this.y >= s.y + 100){ //topside
			return false;	
		}
		return true;
	}

}

class Controller
{
	constructor(model, view){
		this.model = model;
		this.view = view;
		this.key_right = false;
		this.key_left = false;
		this.key_up = false;
		this.key_down = false;
		this.space = false;
		let self = this;
        document.addEventListener('keyup', function(event) {self.keyUp(event);}, false);
        document.addEventListener('keydown', function(event) {self.keyDown(event); }, false);
	}
	onClick(event)
	{
	}
	keyDown = function(event){
		if (event.keyCode == 39) this.key_right = true;
        else if (event.keyCode == 37) this.key_left = true;
        else if (event.keyCode == 40) this.key_down = true;
        else if (event.keyCode == 32) this.space = true;
		
	}
	keyUp(event){
		if (event.keyCode == 39) this.key_right = false;
        else if (event.keyCode == 37) this.key_left = false;
        else if (event.keyCode == 40) this.key_down = false;
        else if (event.keyCode == 32) this.space = false;
        
	}
	update(){
		this.model.mario.preMario();
		if(this.key_right){
			this.model.mario.x += 10;
			this.model.mario.updateImageNum();
		}
		if(this.key_left){
			this.model.mario.x -= 10;
			this.model.mario.updateImageNumBack();
		}
		if(this.space){
			if(this.model.mario.jumpCount > 5){
				this.model.mario.preMarioY = this.model.mario.y
			}
			this.model.mario.jump();
		}
	}
}

class Mario extends Sprite
{
	constructor(x, y, model)
	{
		super(x, y, 60, 95);
		this.model = model;
		this.imageNum = 0;
		this.countMario = 0;
		this.image.src = "mario1.png";
		this.jumpCount = 0;
		this.marioScreenLocation = 150;
		this.type = "mario";
		this.vert_velocity = 0;
		this.images = [];
		this.imageNum = ["mario1.png", "mario2.png", "mario3.png", "mario4.png", "mario5.png"];
		for(let i = 0; i < this.imageNum.length; i++){
			this.images[i] = new Image();
			this.images[i].src = this.imageNum[i];
		}
	}
	preMario(){
		this.preMarioX = this.x;
		this.preMarioY = this.y;
	}
	update(){
		this.vert_velocity += 9.8;
		this.y += this.vert_velocity;
		this.jumpCount++;
		if(this.y >= 350){
			this.y = 350;
			this.vert_velocity = 0;
			this.jumpCount = 0;
		}
	return true;
	}
	isMario(){
		return true;
	}
	jump()
	{
		if(this.jumpCount <= 12){
			this.vert_velocity -= 12;
		}
	}
	updateImageNum(){
		this.countMario++;
		if(this.countMario > 4){
			this.countMario = 0;
		}
		this.image = this.images[this.countMario];
	}
	updateImageNumBack(){
		this.countMario--;
		if(this.countMario < 0){
			this.countMario = 4;
		}
		this.image = this.images[this.countMario];
	}

	getOutOfObject(s){
		if(this.x + 60 >= s.x && this.preMarioX + 60 <= s.x){ 
				this.x = s.x - 60;
			}
			else if(this.x <= s.x + 100 && this.preMarioX >= s.x + 100){
				this.x = s.x + 100;
			}
			else if(this.y + 95 >= s.y && this.preMarioY <= s.y){   
				this.y = s.y - 95;
				this.vert_velocity = 0;
				this.jumpCount = 0;
			}
			else if(this.y <= s.y + 100 && this.preMarioY >= s.y + 100){
				this.jumpCount = 15;
				this.vert_velocity = 0;
				this.y = s.y + 100;
				
				if(s.x == 279){ 
					this.coinCount--;
				}
			}
	}
}	
class Coin extends Sprite{
	constructor(x, y, w, h, model){
		super(x, y, 20, 20);
		this.image = new Image();
		this.image.src = "coin.png";
		let rand = Math.random();
		this.type = "coin";
		this.vertVelocity = 0;
		this.horVelocity = rand*30;
		let empty = false;
		
	}
	update(){
		this.vertVelocity += 2;
		this.y += this.vertVelocity;
		this.x += this.horVelocity;
	}

}

class Brick extends Sprite{
	constructor(x, y, w, h){
		super(x, y, 100, 100);
		this.type = "brick";
		this.image = new Image();
		this.image.src = "brick.png";
	}
	isBrick()
	{
		return true;
	}
}


class Model
{	
	constructor()
	{
		this.sprite = [];
		this.mario = new Mario(150, 50);
		this.sprite.push(this.mario);
		this.brick = new Brick(259, 50);
        this.sprite.push(this.brick);
        this.brick = new Brick(700, 350);
        this.sprite.push(this.brick);
        this.brick = new Brick(1000, 350);
        this.sprite.push(this.brick);
		this.brick = new Brick(379, 50);
		this.sprite.push(this.brick);
		this.brick = new Brick(500, 50);
		this.sprite.push(this.brick);
		this.brick = new Brick(900, 50);
		this.sprite.push(this.brick);
		this.brick = new Brick(650, 100);
		this.sprite.push(this.brick);
		this.coinCountTest = 4;
		this.empty = false;	
	}
	onclick(x,y){	
	}

	addCoin(x, y)
    {
        this.c = new Coin(x,y, this);
        this.sprite.push(this.c);
		this.coinCount++;
	
    }
	update()
	{
		for(let i = 0; i < this.sprite.length; i++)
		{
			this.sprite[i].update();
			if(this.sprite[i] instanceof Brick){
				this.s = this.sprite[i];

				if(this.mario.checkCollision(this.s)){
					
					this.mario.getOutOfObject(this.s);
					if(this.s.x == 379){
						if (this.coinCountTest >= 0) {
							this.addCoin(this.s.x/2, this.s.y-50)
							this.coinCountTest--;
						}
						else{
							this.empty = true;
							break;
						}
					}
				}
			}
		}
	}
}

class View
{
	constructor(model){
		this.model = model;
		this.canvas = document.getElementById("myCanvas");
		this.marioPosition = 150;
		this.background = new Image()
		this.background.src = "background.png"
		
	}
	update(){
		let can = this.canvas.getContext("2d");
		can.drawImage(this.background, (-this.model.mario.x)*.25, 0, 4000, 500);
		for(let i = 0; i < this.model.sprite.length; i++){
			let s = this.model.sprite[i]
			
			if(s instanceof Mario)
              	can.drawImage(s.image, this.model.mario.marioScreenLocation, this.model.mario.y);

			if(s instanceof Brick){
				if(s.x == 379 && !this.model.empty) {
					s.image.src = "coinBrick.png";
					can.drawImage(s.image, s.x - this.model.mario.x + this.marioScreenLocation, s.y);
					if(this.model.coinCountTest <= -1)
						s.image.src = "brick.png";
						can.drawImage(s.image, s.x - this.model.mario.x + this.marioScreenLocation, s.y);
				}
				can.drawImage(s.image, s.x - this.model.mario.x + this.model.mario.marioScreenLocation, s.y, 100, 100);
			}
			if(s instanceof Coin)
				can.drawImage(s.image, s.x, s.y);
		}
	}
}

class Game
{
	constructor(){
		this.model = new Model();
		this.view = new View(this.model);
		this.controller = new Controller(this.model, this.view);
	}
	onTimer()
	{
		this.controller.update();
		this.model.update();
		this.view.update();
	}
}
let game = new Game();
let timer = setInterval(function() {game.onTimer(); }, 40);


</script>
</body>



class Mario(Sprite):
    def __init__(self, x, y, width, height):
        super().__init__(x, y, width, height)
        self.marioScreenLocation = 150
        self.imageNum = 0
        self.vert_velocity = 0

        self.marioImage = pygame.image.load("mario1.png")
        self.marioImage = pygame.transform.scale(self.marioImage, (60,95))
        self.marioImages = []
        self.marioImagesArray = [pygame.image.load("mario1.png"), pygame.image.load("mario2.png"), pygame.image.load("mario3.png"), pygame.image.load("mario4.png"), pygame.image.load("mario5.png")]

        for i in range(len(self.marioImagesArray)):
            self.marioImages.append(self.marioImagesArray[i])

    def isMario():
        return True
    def draw(self, screen):
        screen.blit(self.marioImage, (self.marioScreenLocation, self.y, self.width, self.height))
    def updateImageNum(self):
        self.imageNum += 1
        if(self.imageNum > 4):
            self.imageNum = 0
        self.marioImage = self.marioImages[self.imageNum]
    def update(self):
        self.vert_velocity += 9.8
        self.y += self.vert_velocity
        if(self.y > 448):
            self.vert_velocity = 0
            self.y = 448
        return True
		